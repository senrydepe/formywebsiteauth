<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PARAEL CHECKER - LENGKAP & TEMA</title>

  <!-- Bootstrap 4.6 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome 4.7 -->
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

  <style>
    body.theme-default {
      background: linear-gradient(135deg, #6e8efb, #a777e3);
      color: #333;
    }
    body.theme-dark {
      background: #13131a !important;
      color: #eee !important;
    }
    body.theme-dark .result-list,
    body.theme-dark .card {
      background: #242435 !important;
      color: #eee !important;
    }
    body.theme-dark .form-checker {
      background: #181820 !important;
      color: #eee !important;
    }
    body.theme-blue {
      background: linear-gradient(120deg, #36d1c4, #51a9f6 80%) !important;
      color: #223;
    }
    body.theme-blue .result-list,
    body.theme-blue .card {
      background: #d3efff !important;
      color: #223 !important;
    }
    body.theme-blue .form-checker {
      background: #c7edfc !important;
      color: #223 !important;
    }
    body.theme-soft {
      background: #f5f6fa !important;
      color: #555;
    }
    body.theme-soft .result-list,
    body.theme-soft .card,
    body.theme-soft .form-checker {
      background: #fff !important;
      color: #555 !important;
    }
    body.theme-purple {
      background: linear-gradient(45deg,#7F7FD5,#86A8E7,#91EAE4,#ffafcc);
      color: #fff;
    }
    body.theme-purple .result-list,
    body.theme-purple .card,
    body.theme-purple .form-checker {
      background: rgba(255,255,255,0.13) !important;
      color: #fff !important;
    }
    body.theme-green {
      background: linear-gradient(140deg,#11998e,#38ef7d 80%);
      color: #fff;
    }
    body.theme-green .result-list,
    body.theme-green .card,
    body.theme-green .form-checker {
      background: rgba(255,255,255,0.16) !important;
      color: #fff !important;
    }

    body {
      min-height: 100vh;
      font-family: 'Muli', sans-serif;
      transition: background 0.5s, color 0.5s;
      padding-top: 20px;
    }
    textarea.form-checker {
      resize: vertical;
      min-height: 140px;
      font-family: monospace;
      font-size: 1rem;
      white-space: pre-wrap;
    }
    .result-list {
      max-height: 220px;
      overflow-y: auto;
      background: #f9f9f9;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 0.9rem;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .btn-copy, .btn-copy1, .btn-trash {
      margin-left: 5px;
    }
    .badge-charge {
      background: linear-gradient(45deg, #009966, #33FF99);
    }
    .badge-live {
      background: linear-gradient(45deg, #17a2b8, #66dffe);
    }
    .badge-die {
      background: linear-gradient(45deg, #ff5a5f, #f65a83);
    }
    button.btn-toggle i {
      font-size: 1.1rem;
      vertical-align: middle;
    }
  </style>
</head>
<body class="theme-default">

<div class="container my-4">

  <!-- Pilih Tema -->
  <div class="mb-3 text-center">
    <label for="themeSelector" class="font-weight-bold mr-2"></label>
    <select id="themeSelector" class="form-control d-inline-block w-auto" style="min-width:130px;">
      <option value="theme-default">DEFAULT</option>
      <option value="theme-dark">DARK</option>
      <option value="theme-blue">BLUE</option>
      <option value="theme-soft">SOFT GRAY</option>
      <option value="theme-purple">PURPLE</option>
      <option value="theme-green">GREEN EMERALD</option>
    </select>
  </div>

  <!-- Input dan tombol -->
  <div class="row">
    <div class="col-lg-8 mb-3">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <h3 class="mb-3 font-weight-bold">PARAEL CHECKER</h3>
          <textarea class="form-control form-checker" placeholder="MASUKKAN KARTU DALAM FORMAT: CC|MM|YY|CVV  (SATU PER BARIS)" spellcheck="false"></textarea>
          <div class="my-3">
            <div class="d-flex justify-content-between">
              <button class="btn btn-primary btn-glow btn-bg-gradient text-white btn-play" style="width:48%"><i class="fa fa-play mr-2"></i>START</button>
              <button class="btn btn-danger btn-glow btn-bg-gradient text-white btn-stop" style="width:48%" disabled><i class="fa fa-stop mr-2"></i>STOP</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistik -->
    <div class="col-lg-4 mb-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5>STATISTICS</h5>
          <hr />
          <div class="d-flex justify-content-between font-weight-bold">
            <div>APPROVED</div><div class="badge badge-charge px-3 charge">0</div>
          </div>
          <hr />
          <div class="d-flex justify-content-between font-weight-bold">
            <div>LIVE</div><div class="badge badge-live px-3 aprovadas">0</div>
          </div>
          <hr />
          <div class="d-flex justify-content-between font-weight-bold">
            <div>DECLINED</div><div class="badge badge-die px-3 reprovadas">0</div>
          </div>
          <hr />
          <div class="d-flex justify-content-between font-weight-bold">
            <div>TOTAL</div><div class="badge badge-primary px-3 carregadas">0</div>
          </div>
          <hr />
          <div class="d-flex justify-content-between font-weight-bold">
            <div>LIMIT</div><div class="badge badge-secondary px-3">99999999</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Result Lists -->
  <div class="row mb-4">
    <div class="col-xl-4 mb-3">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0"><i class="fa fa-check-circle text-success"></i> APPROVED</h5>
            <div>
              <button class="btn btn-primary btn-sm btn-copy1" title="COPY ALL APPROVED"><i class="fa fa-copy"></i></button>
            </div>
          </div>
          <div id="lista_charge" class="result-list flex-grow-1"></div>
        </div>
      </div>
    </div>

    <div class="col-xl-4 mb-3">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0"><i class="fa fa-check text-info"></i> CVV/CCN</h5>
            <div>
              <button class="btn btn-primary btn-sm btn-copy" title="COPY ALL CVV/CCN"><i class="fa fa-copy"></i></button>
            </div>
          </div>
          <div id="lista_aprovadas" class="result-list flex-grow-1"></div>
        </div>
      </div>
    </div>

    <div class="col-xl-4 mb-3">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0"><i class="fa fa-times text-danger"></i> DECLINED</h5>
            <div>
              <button class="btn btn-danger btn-sm btn-trash" title="CLEAR DECLINED"><i class="fa fa-trash"></i></button>
            </div>
          </div>
          <div id="lista_reprovadas" class="result-list flex-grow-1"></div>
        </div>
      </div>
    </div>
  </div>

</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
$(document).ready(function() {
  // Tema
  const allThemes = ["theme-default","theme-dark","theme-blue","theme-soft","theme-purple","theme-green"];
  const savedTheme = localStorage.getItem('paral_theme') || 'theme-default';
  $('#themeSelector').val(savedTheme);
  $('body').removeClass(allThemes.join(' ')).addClass(savedTheme);

  $('#themeSelector').change(function() {
    const theme = $(this).val();
    $('body').removeClass(allThemes.join(' ')).addClass(theme);
    localStorage.setItem('paral_theme', theme);
  });

  // Fungsi hapus baris pertama textarea
  function removelinha() {
    let lines = $('.form-checker').val().split('\n');
    lines.shift();
    $('.form-checker').val(lines.join('\n'));
  }

  let stopRequested = false;

  // Tombol mulai proses
  $('.btn-play').click(async function() {
    let lista = $('.form-checker').val().trim();
    if (!lista) {
      Swal.fire({
        title: 'MASUKKAN KARTU !!!',
        icon: 'error',
        toast: true,
        position: 'top-end',
        timer: 3000,
      });
      return;
    }

    let array = lista.split('\n').filter(v => v.trim() !== '');
    let charge = 0, lives = 0, dies = 0;

    $('.carregadas').text(array.length);
    $('.btn-play').attr('disabled', true);
    $('.btn-stop').attr('disabled', false);
    stopRequested = false;

    Swal.fire({
      title: 'MEMULAI PENGECEKAN.. MOHON TUNGGU',
      icon: 'info',
      toast: true,
      position: 'top-end',
      timer: 2000,
    });

    for(let i=0; i < array.length; i++) {
      if(stopRequested) break;

      const cc = array[i];
      try {
        let response = await $.ajax({
          url: '/check-card',
          method: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({ cc }),
        });

        let resText = response.result || response;

        // Format hasil jadi dua baris: nomor kartu dan pesan hasil
        let parts = resText.split(' ');
        if(parts.length > 1){
          let firstPart = parts[0];
          let restPart = parts.slice(1).join(' ');
          let regex = /^\d{12,19}\|\d{1,2}\|\d{2,4}\|\d{3,4}$/;
          if(!regex.test(firstPart)){
            let found = resText.match(regex);
            if(found){
              firstPart = found[0];
              restPart = resText.replace(firstPart, '').trim();
            }
          }
          resText = firstPart + '\n' + restPart;
        }

        if(resText.indexOf('✅') >= 0) {
          $('#lista_charge').append(resText + '\n');
          charge++;
        } else if(resText.indexOf('❎') >= 0) {
          $('#lista_aprovadas').append(resText + '\n');
          lives++;
        } else {
          $('#lista_reprovadas').append(resText + '\n');
          dies++;
        }

        removelinha();
      } catch(err) {
        $('#lista_reprovadas').append(cc + ' => ERROR\n');
        removelinha();
        dies++;
      }

      $('.charge').text(charge);
      $('.aprovadas').text(lives);
      $('.reprovadas').text(dies);
      let totalChecked = charge + lives + dies;
      $('.carregadas').text(totalChecked);

      // Delay random 1 - 3 detik agar tidak overload request
      await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
    }

    Swal.fire({
      icon: stopRequested ? "warning" : "success",
      title: stopRequested ? "PROSES DIHENTIKAN" : "SELESAI MENGECEK",
      toast: true,
      position: "top-end",
      timer: 3000,
    });

    $('.btn-play').attr('disabled', false);
    $('.btn-stop').attr('disabled', true);
  });

  // Tombol stop
  $('.btn-stop').click(function() {
    stopRequested = true;
    Swal.fire({
      icon: "warning",
      title: "PROSES DIHENTIKAN",
      toast: true,
      position: "top-end",
      timer: 3000,
    });
    $('.btn-play').attr('disabled', false);
    $('.btn-stop').attr('disabled', true);
  });

  // Copy ke clipboard - Aprroved
  $('.btn-copy1').click(function() {
    let text = $('#lista_charge').text().trim();
    if(text.length === 0){
      Swal.fire('No approved cards to copy!', '', 'info');
      return;
    }
    copyToClipboard(text);
    Swal.fire({
      title: 'COPY APPROVED CARDS SUCCESS',
      icon: 'success',
      toast: true,
      position: 'top-end',
      timer: 3000,
    });
  });

  // Copy ke clipboard - Live
  $('.btn-copy').click(function() {
    let text = $('#lista_aprovadas').text().trim();
    if(text.length === 0){
      Swal.fire('No live cards to copy!', '', 'info');
      return;
    }
    copyToClipboard(text);
    Swal.fire({
      title: 'COPY LIVE CARDS SUCCESS',
      icon: 'success',
      toast: true,
      position: 'top-end',
      timer: 3000,
    });
  });

  // Clear declined list
  $('.btn-trash').click(function() {
    $('#lista_reprovadas').empty();
    Swal.fire({
      title: 'DAFTAR DECLINED DIKOSONGKAN',
      icon: 'success',
      toast: true,
      position: 'top-end',
      timer: 3000,
    });
  });

  function copyToClipboard(text) {
    let ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
  }
});
</script>

</body>
</html>

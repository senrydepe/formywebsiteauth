<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PARAEL CHECKER</title>

  <!-- Bootstrap 4.6 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome 4.7 -->
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

  <style>
    body.theme-default {
      background: linear-gradient(135deg, #6e8efb, #a777e3);
      color: #333;
    }
    body.theme-dark {
      background: #13131a !important;
      color: #eee !important;
    }
    body.theme-dark .result-list,
    body.theme-dark .card {
      background: #242435 !important;
      color: #eee !important;
    }
    body.theme-dark .form-checker {
      background: #181820 !important;
      color: #eee !important;
    }
    body.theme-blue {
      background: linear-gradient(120deg, #36d1c4, #51a9f6 80%) !important;
      color: #223;
    }
    body.theme-blue .result-list,
    body.theme-blue .card {
      background: #d3efff !important;
      color: #223 !important;
    }
    body.theme-blue .form-checker {
      background: #c7edfc !important;
      color: #223 !important;
    }
    body.theme-soft {
      background: #f5f6fa !important;
      color: #555;
    }
    body.theme-soft .result-list,
    body.theme-soft .card,
    body.theme-soft .form-checker {
      background: #fff !important;
      color: #555 !important;
    }
    body.theme-purple {
      background: linear-gradient(45deg,#7F7FD5,#86A8E7,#91EAE4,#ffafcc);
      color: #fff;
    }
    body.theme-purple .result-list,
    body.theme-purple .card,
    body.theme-purple .form-checker {
      background: rgba(255,255,255,0.13) !important;
      color: #fff !important;
    }
    body.theme-green {
      background: linear-gradient(140deg,#11998e,#38ef7d 80%);
      color: #fff;
    }
    body.theme-green .result-list,
    body.theme-green .card,
    body.theme-green .form-checker {
      background: rgba(255,255,255,0.16) !important;
      color: #fff !important;
    }

    body {
      min-height: 100vh;
      font-family: 'Muli', sans-serif;
      transition: background 0.5s, color 0.5s;
      padding-top: 20px;
    }
    textarea.form-checker {
      resize: vertical;
      min-height: 140px;
      font-family: monospace;
      font-size: 1rem;
      white-space: pre-wrap;
    }
    .result-list {
      max-height: 220px;
      overflow-y: auto;
      background: #f9f9f9;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 0.9rem;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .btn-copy, .btn-copy1, .btn-trash, .btn-download {
      margin-left: 5px;
    }
    .badge-charge {
      background: linear-gradient(45deg, #009966, #33FF99);
    }
    .badge-live {
      background: linear-gradient(45deg, #17a2b8, #66dffe);
    }
    .badge-die {
      background: linear-gradient(45deg, #ff5a5f, #f65a83);
    }
    button.btn-toggle i {
      font-size: 1.1rem;
      vertical-align: middle;
    }
    /* Toggle THEME */
    #themeSelectorWrapper {
      display: none;
    }
    #toggleTheme i {
      margin-right: 5px;
      transition: transform 0.3s ease;
    }

    /* Mobile optimizations */
    @media (max-width: 576px) {
      .btn-glow {
        font-size: 1.2rem;
        padding: 0.75rem;
      }
      textarea.form-checker {
        min-height: 180px;
        font-size: 1.1rem;
      }
      .result-list {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body class="theme-default">

<div class="container my-4">

  <!-- THEME selector toggle -->
  <div class="mb-3 text-center">
    <button id="toggleTheme" class="btn btn-sm btn-outline-secondary mb-2" type="button">
      <i class="fa fa-angle-up"></i> THEME
    </button>
    <div id="themeSelectorWrapper">
      <select id="themeSelector" class="form-control d-inline-block w-auto" style="min-width:130px;">
        <option value="theme-default">Default</option>
        <option value="theme-dark">Dark</option>
        <option value="theme-blue">Blue</option>
        <option value="theme-soft">Soft Gray</option>
        <option value="theme-purple">Purple</option>
        <option value="theme-green">Green Emerald</option>
      </select>
    </div>
  </div>
  
  <!-- Form Input dan Tombol -->
  <div class="row">
    <div class="col-lg-8 mb-3">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <h3 class="mb-3 font-weight-bold">PARAEL CHECKER</h3>
          <textarea class="form-control form-checker" placeholder="PUT YOUR CC HERE (format: cc|mm|yy|cvv)"></textarea>
          <div class="my-3">
            <a href="#" class="btn btn-outline-info btn-block mb-3">STRIPE AUTH</a>
            <div class="d-flex justify-content-between align-items-center">
              <button class="btn btn-primary btn-glow btn-bg-gradient text-white btn-play" style="width:48%">
                <i class="fa fa-play mr-2"></i>START
              </button>
              <button class="btn btn-danger btn-glow btn-bg-gradient text-white btn-stop" style="width:48%" disabled>
                <i class="fa fa-stop mr-2"></i>STOP
              </button>
            </div>
            <!-- Progress bar -->
            <div class="progress my-2" style="height: 8px; display:none;" id="progressWrapper">
              <div class="progress-bar" id="progressChecker" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistik -->
    <div class="col-lg-4 mb-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5>STATISTICS</h5>
          <hr />
          <div class="d-flex justify-content-between align-items-center font-weight-bold">
            <span>APPROVED</span>
            <span class="badge badge-charge px-3 charge">0</span>
          </div>
          <hr />
          <div class="d-flex justify-content-between align-items-center font-weight-bold">
            <span>LIVE</span>
            <span class="badge badge-live px-3 aprovadas">0</span>
          </div>
          <hr />
          <div class="d-flex justify-content-between align-items-center font-weight-bold">
            <span>DIE</span>
            <span class="badge badge-die px-3 reprovadas">0</span>
          </div>
          <hr />
          <div class="d-flex justify-content-between align-items-center font-weight-bold">
            <span>TOTAL</span>
            <span class="badge badge-primary px-3 carregadas">0</span>
          </div>
          <hr />
      </div>
    </div>
  </div>

  <!-- Hasil -->
  <div class="row mb-4">
    <div class="col-xl-4 mb-3">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0"><i class="fa fa-check-circle text-success"></i> APPROVED</h5>
            <div>
              <button class="btn btn-primary btn-sm btn-toggle show-charge" type="show" title="Show/Hide Charged">
                <i class="fa fa-eye-slash"></i>
              </button>
              <button class="btn btn-success btn-sm btn-copy1" title="Copy All Charged">
                <i class="fa fa-copy"></i>
              </button>
              <button id="downloadCharge" class="btn btn-outline-primary btn-sm btn-download" title="Download CHARGED Result">
                <i class="fa fa-download"></i>
              </button>
              <button class="btn btn-danger btn-sm btn-trash-charge" title="Clear Charged Cards">
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </div>
          <div id="lista_charge" class="result-list medium-font flex-grow-1"></div>
        </div>
      </div>
    </div>

    <div class="col-xl-4 mb-3">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0"><i class="fa fa-check text-info"></i> CVV/CCN</h5>
            <div>
              <button class="btn btn-primary btn-sm btn-toggle show-lives" type="show" title="Show/Hide CVV/CCN">
                <i class="fa fa-eye-slash"></i>
              </button>
              <button class="btn btn-success btn-sm btn-copy" title="COPY ALL CVV/CCN">
                <i class="fa fa-copy"></i>
              </button>
              <button id="downloadLive" class="btn btn-outline-primary btn-sm btn-download" title="Download LIVE Result">
                <i class="fa fa-download"></i>
              </button>
              <button class="btn btn-danger btn-sm btn-trash-live" title="Clear Live Cards">
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </div>
          <div id="lista_aprovadas" class="result-list medium-font flex-grow-1"></div>
        </div>
      </div>
    </div>

    <div class="col-xl-4 mb-3">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0"><i class="fa fa-times text-danger"></i> DECLINED</h5>
            <div>
              <button class="btn btn-primary btn-sm btn-toggle show-dies" type="show" title="Show/Hide Declined">
                <i class="fa fa-eye-slash"></i>
              </button>
              <button class="btn btn-danger btn-sm btn-trash" title="Clear Declined">
                <i class="fa fa-trash"></i>
              </button>
              <button id="downloadDeclined" class="btn btn-outline-primary btn-sm btn-download" title="Download DECLINED Result">
                <i class="fa fa-download"></i>
              </button>
            </div>
          </div>
          <div id="lista_reprovadas" class="result-list medium-font flex-grow-1"></div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Sound notifications -->
<audio id="soundCharged" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>
<audio id="soundLive" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
$(document).ready(function() {

  const allThemes = [
    "theme-default","theme-dark","theme-blue",
    "theme-soft","theme-purple","theme-green"
  ];

  // Theme otomatis sesuai waktu (jika belum ada di localStorage)
  const hourNow = new Date().getHours();
  if(!localStorage.getItem('paral_theme')) {
    if(hourNow >= 19 || hourNow < 6) {
      $('#themeSelector').val('theme-dark');
      $('body').removeClass(allThemes.join(' ')).addClass('theme-dark');
      localStorage.setItem('paral_theme', 'theme-dark');
    } else {
      $('#themeSelector').val('theme-default');
      $('body').removeClass(allThemes.join(' ')).addClass('theme-default');
      localStorage.setItem('paral_theme', 'theme-default');
    }
  }

  // Atur tema dari penyimpanan / selector
  const savedTheme = localStorage.getItem('paral_theme') || 'theme-default';
  $('#themeSelector').val(savedTheme);
  $('body').removeClass(allThemes.join(' ')).addClass(savedTheme);

  $('#themeSelector').change(function() {
    const theme = $(this).val();
    $('body').removeClass(allThemes.join(' ')).addClass(theme);
    localStorage.setItem('paral_theme', theme);
  });

  // --- Toggle THEME wrapper ---
  $('#themeSelectorWrapper').hide();
  $('#toggleTheme i').removeClass('fa-angle-down').addClass('fa-angle-up');

  $('#toggleTheme').click(function() {
    var wrapper = $('#themeSelectorWrapper');
    wrapper.slideToggle(200);

    var icon = $(this).find('i');
    if(wrapper.is(':visible')) {
      icon.removeClass('fa-angle-up').addClass('fa-angle-down');
    } else {
      icon.removeClass('fa-angle-down').addClass('fa-angle-up');
    }
  });

  $('.show-charge').click(function() {
    var btn = $(this), list = $('#lista_charge'), type = btn.attr('type');
    list.slideToggle();
    btn.html(type === 'show' ? '<i class="fa fa-eye"></i>' : '<i class="fa fa-eye-slash"></i>');
    btn.attr('type', type === 'show' ? 'hidden' : 'show');
  });
  $('.show-lives').click(function() {
    var btn = $(this), list = $('#lista_aprovadas'), type = btn.attr('type');
    list.slideToggle();
    btn.html(type === 'show' ? '<i class="fa fa-eye"></i>' : '<i class="fa fa-eye-slash"></i>');
    btn.attr('type', type === 'show' ? 'hidden' : 'show');
  });
  $('.show-dies').click(function() {
    var btn = $(this), list = $('#lista_reprovadas'), type = btn.attr('type');
    list.slideToggle();
    btn.html(type === 'show' ? '<i class="fa fa-eye"></i>' : '<i class="fa fa-eye-slash"></i>');
    btn.attr('type', type === 'show' ? 'hidden' : 'show');
  });

  // Clear Declined cards
  $('.btn-trash').click(function() {
    Swal.fire({
      title: 'REMOVE CC DIE SUCCESS',
      icon: 'success',
      showConfirmButton: false,
      toast: true,
      position: 'top-end',
      timer: 3000,
    });
    $('#lista_reprovadas').empty();
    saveToLocalStorage();
  });

  // Clear LIVE cards
  $('.btn-trash-live').click(function() {
    Swal.fire({
      title: 'REMOVE CC LIVE SUCCESS',
      icon: 'success',
      showConfirmButton: false,
      toast: true,
      position: 'top-end',
      timer: 3000,
    });
    $('#lista_aprovadas').empty();
    saveToLocalStorage();
  });

  // Clear CHARGED cards
  $('.btn-trash-charge').click(function() {
    Swal.fire({
      title: 'REMOVE CC APPROVED SUCCESS',
      icon: 'success',
      showConfirmButton: false,
      toast: true,
      position: 'top-end',
      timer: 3000,
    });
    $('#lista_charge').empty();
    saveToLocalStorage();
  });

  $('.btn-copy1').click(function() {
    var text = $('#lista_charge').text();
    if (text.trim().length === 0) {
      Swal.fire('No approved cards to copy!', '', 'info');
      return;
    }
    copyToClipboard(text);
    Swal.fire({
      title: 'COPY CC APPROVED SUCCESS',
      icon: 'success',
      toast: true,
      position: 'top-end',
      timer: 3000,
    });
  });

  $('.btn-copy').click(function() {
    var text = $('#lista_aprovadas').text();
    if (text.trim().length === 0) {
      Swal.fire('No live cards to copy!', '', 'info');
      return;
    }
    copyToClipboard(text);
    Swal.fire({
      title: 'COPY CC LIVE SUCCESS',
      icon: 'success',
      toast: true,
      position: 'top-end',
      timer: 3000,
    });
  });

  // Fungsi copy ke clipboard
  function copyToClipboard(text) {
    var ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
  }

  // Fungsi hapus baris pertama input textarea tanpa split-join ulang
  function removelinha() {
    let val = $('.form-checker').val();
    let idx = val.indexOf('\n');
    if(idx !== -1) {
      $('.form-checker').val(val.substring(idx + 1));
    } else {
      $('.form-checker').val('');
    }
  }

  // Fungsi simpan hasil checker ke localStorage
  function saveToLocalStorage() {
    localStorage.setItem('checker_charge', $('#lista_charge').text());
    localStorage.setItem('checker_live', $('#lista_aprovadas').text());
    localStorage.setItem('checker_die', $('#lista_reprovadas').text());
  }
  // Fungsi load hasil dari localStorage
  function loadFromLocalStorage() {
    let charge = localStorage.getItem('checker_charge') || '';
    let live = localStorage.getItem('checker_live') || '';
    let die = localStorage.getItem('checker_die') || '';
    $('#lista_charge').text(charge);
    $('#lista_aprovadas').text(live);
    $('#lista_reprovadas').text(die);
  }

  // Panggil load saat ready
  loadFromLocalStorage();

  // Fungsi untuk download text file hasil checker
  function downloadResult(filename, text) {
    var element = document.createElement('a');
    var file = new Blob([text], {type: 'text/plain'});
    element.href = URL.createObjectURL(file);
    element.download = filename;
    document.body.appendChild(element);
    element.click();
    document.body.removeChild(element);
  }

  // Listener tombol download hasil
  $('#downloadCharge').click(function(){
    var text = $('#lista_charge').text().trim();
    if(!text) {
      Swal.fire('No approved cards to download!','','info');
      return;
    }
    downloadResult('approved_cards.txt', text);
  });

  $('#downloadLive').click(function(){
    var text = $('#lista_aprovadas').text().trim();
    if(!text) {
      Swal.fire('No live cards to download!','','info');
      return;
    }
    downloadResult('live_cards.txt', text);
  });

  $('#downloadDeclined').click(function(){
    var text = $('#lista_reprovadas').text().trim();
    if(!text) {
      Swal.fire('No declined cards to download!','','info');
      return;
    }
    downloadResult('declined_cards.txt', text);
  });

  // Audio Notification elements
  const audioCharged = document.getElementById('soundCharged');
  const audioLive = document.getElementById('soundLive');

  let stopRequested = false;

  $('.btn-play').click(async function() {
    let lista = $('.form-checker').val().trim();
    if (!lista) {
      Swal.fire({
        title: 'PUT YOUR CARD 😮‍💨',
        icon: 'error',
        toast: true,
        position: 'top-end',
        timer: 3000,
      });
      return false;
    }

    // Bersihkan input: hapus kosong, trim dan hapus duplikat
    let lines = lista.split('\n').map(l => l.trim()).filter(l => l.length > 0);
    lines = [...new Set(lines)];

    // Validasi format kartu: cc|mm|yy|cvv
    const ccFormat = /^\d{12,19}\|\d{1,2}\|\d{2,4}\|\d{3,4}$/;
    let invalidEntries = lines.filter(line => !ccFormat.test(line));
    if(invalidEntries.length > 0) {
      Swal.fire({
        title: 'Format Invalid Detected',
        html: 'Beberapa baris tidak sesuai format:<br><code>'+ invalidEntries.join('<br>') +'</code>',
        icon: 'error',
        customClass: {popup: 'text-left'},
        width: '500px',
      });
      return false;
    }

    // Set ulang textarea input dengan data bersih dan valid
    $('.form-checker').val(lines.join('\n'));

    let charge = 0, lives = 0, dies = 0;

    $('.carregadas').text(lines.length);
    $('.btn-play').attr('disabled', true);
    $('.btn-stop').attr('disabled', false);
    stopRequested = false;

    // Tampilkan progress bar dan reset
    $('#progressWrapper').show();
    $('#progressChecker').css('width', '0%').attr('aria-valuenow', 0);

    Swal.fire({
      title: 'PLEASE WAIT...⏳',
      icon: 'success',
      toast: true,
      position: 'top-end',
      timer: 4000,
    });

    for (let i=0; i < lines.length; i++) {
      if(stopRequested) break;

      const data = lines[i];
      try {
        let response = await $.ajax({
          url: '/check-card',
          method: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({ cc: data }),
        });

        let resText = response.result || response;

        // Pecah nomor cc dan status jadi dua baris
        let parts = resText.split(' ');
        if(parts.length > 1){
          let firstPart = parts[0];
          let restPart = parts.slice(1).join(' ');
          let regex = /^\d{12,19}\|\d{1,2}\|\d{2,4}\|\d{3,4}$/;
          if(!regex.test(firstPart)){
            let found = resText.match(regex);
            if(found){
              firstPart = found[0];
              restPart = resText.replace(firstPart, '').trim();
            }
          }
          resText = firstPart + '\n' + restPart;
        }

        if(resText.indexOf('added ✅') >= 0) {
          audioCharged.play();
          Swal.fire({
            title: '+1 APPROVED CC',
            icon: 'success',
            toast: true,
            position: 'top-end',
            timer: 900
          });
          $('#lista_charge').append(resText + '\n');
          removelinha();
          charge++;

          saveToLocalStorage();

        } else if(resText.indexOf('❎') >= 0) {
          audioLive.play();
          Swal.fire({
            title: '+1 LIVE CC',
            icon: 'success',
            toast: true,
            position: 'top-end',
            timer: 900
          });
          $('#lista_aprovadas').append(resText + '\n');
          removelinha();
          lives++;

          saveToLocalStorage();

        } else {
          $('#lista_reprovadas').append(resText + '\n');
          removelinha();
          dies++;

          saveToLocalStorage();
        }
      } catch (err) {
        $('#lista_reprovadas').append(data + ' => ERROR\n');
        removelinha();
        dies++;
        saveToLocalStorage();
      }

      $('.charge').text(charge);
      $('.aprovadas').text(lives);
      $('.reprovadas').text(dies);

      let totalChecked = charge + lives + dies;
      $('.carregadas').text(totalChecked);

      // Update progress bar
      let progressPercent = Math.round(((i + 1) / lines.length) * 100);
      $('#progressChecker').css('width', progressPercent + '%').attr('aria-valuenow', progressPercent);

      // Delay 1-3 detik seperti semula
      await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
    }

    $('#progressWrapper').hide();

    Swal.fire({
      title: stopRequested ? 'PROCESS PAUSED' : 'PROCESS COMPLETED',
      icon: stopRequested ? 'warning' : 'success',
      toast: true,
      position: 'top-end',
      timer: 3000,
    });

    $('.btn-play').attr('disabled', false);
    $('.btn-stop').attr('disabled', true);
  });

  $('.btn-stop').click(function() {
    stopRequested = true;
    Swal.fire({
      title: 'PROCESS PAUSED',
      icon: 'warning',
      toast: true,
      position: 'top-end',
      timer: 3000,
    });
    $('.btn-play').attr('disabled', false);
    $('.btn-stop').attr('disabled', true);
  });

  // Keyboard shortcut Ctrl+D untuk ganti theme dark-default
  $(document).keydown(function(e) {
    if(e.ctrlKey && e.key.toLowerCase() === 'd') {
      e.preventDefault();

      let currentTheme = $('#themeSelector').val();
      let newTheme = currentTheme === 'theme-dark' ? 'theme-default' : 'theme-dark';

      $('#themeSelector').val(newTheme).trigger('change');

      Swal.fire({
        title: `Theme switched to ${newTheme.replace('theme-', '')}`,
        icon: 'info',
        toast: true,
        position: 'top-end',
        timer: 2000,
      });
    }
  });

});
</script>

</body>
</html>
